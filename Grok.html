<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Google in AR (Working)</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.7/aframe/build/aframe-ar-nft.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    .msg {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); color: white; padding: 14px 28px;
      border-radius: 50px; font: 16px Arial; z-index: 1000;
      pointer-events: none; transition: opacity 0.6s;
    }
    .msg.hide { opacity: 0; }
  </style>
</head>
<body>

  <a-scene
    embedded
    arjs="trackingMethod: best; sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    gesture-detector
    renderer="logarithmicDepthBuffer: true;"
    vr-mode-ui="enabled: false"
    xr-mode-ui="enabled: false"
  >

    <!-- Camera with hit-test -->
    <a-camera id="cam" cursor="rayOrigin: mouse" raycaster="objects: .hit"></a-camera>

    <!-- Google plane (hidden until placed) -->
    <a-plane
      id="google"
      visible="false"
      width="2"
      height="1.1"
      rotation="-90 0 0"
      material="src: https://api.allorigins.us/get?url=https%3A//www.google.com; side: double;"
      class="hit"
    ></a-plane>

  </a-scene>

  <div class="msg" id="msg">Tap any surface to place Google</div>

  <script>
    // Wait for AR.js to be ready
    document.querySelector('a-scene').addEventListener('arjs-nft-init', () => {
      const scene = document.querySelector('a-scene');
      const plane = document.querySelector('#google');
      const msg = document.querySelector('#msg');
      let placed = false;

      scene.addEventListener('click', (e) => {
        if (placed) return;
        const hit = e.detail.intersection;
        if (!hit) return;

        placed = true;
        const p = hit.point;
        plane.setAttribute('position', `${p.x} ${p.y + 0.5} ${p.z}`);
        plane.setAttribute('visible', true);

        msg.classList.add('hide');
        setTimeout(() => msg.style.display = 'none', 600);

        // Add shadow
        const shadow = document.createElement('a-plane');
        shadow.setAttribute('rotation', '-90 0 0');
        shadow.setAttribute('position', `${p.x} ${p.y + 0.01} ${p.z}`);
        shadow.setAttribute('width', 2.2); shadow.setAttribute('height', 2.2);
        shadow.setAttribute('material', 'color: #000; opacity: 0.2; transparent: true');
        scene.appendChild(shadow);
      });
    });
  </script>

</body>
</html>
