<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Tap to Place Webpage in AR</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.7/aframe/build/aframe-ar-nft.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">
  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true;"
    xr-mode-ui="enabled: false"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    gesture-detector
  >

    <!-- Hit-test cursor (invisible but needed) -->
    <a-entity id="cursor" cursor="fuse: false" raycaster="objects: .clickable" position="0 0 -1"></a-entity>

    <!-- Your webpage plane (starts hidden) -->
    <a-plane
      id="webpage"
      visible="false"
      width="1.6" height="0.9"
      material="src: https://www.stpaulcopticservice.org; side: double; transparent: true;"
      position="0 0.5 0"
      rotation="-90 0 0"
      class="clickable"
      animation__fadein="property: components.material.material.opacity; from: 0; to: 1; dur: 500; startEvents: placed"
    ></a-plane>

    <!-- Tap-to-place logic -->
    <a-entity id="placement-helper"></a-entity>

    <!-- Camera -->
    <a-camera id="camera"></a-camera>

  </a-scene>

  <!-- Tap instruction overlay -->
  <div style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); color:white; padding:12px 20px; border-radius:50px; font-family:Arial; font-size:16px; z-index:100; pointer-events:none;">
    Tap any surface to place your webpage
  </div>

  <script>
    AFRAME.registerComponent('tap-place', {
      init: function () {
        const ground = document.querySelector('#placement-helper');
        const webpage = document.querySelector('#webpage');
        const scene = this.el.sceneEl;
        let placed = false;

        this.el.addEventListener('click', (evt) => {
          if (placed) return;
          placed = true;

          const hitTest = evt.detail.intersection;
          if (!hitTest) return;

          const pos = hitTest.point;
          webpage.setAttribute('position', `${pos.x} ${pos.y + 0.5} ${pos.z}`);
          webpage.setAttribute('visible', true);
          webpage.emit('placed');

          // Hide instruction
          document.querySelector('div').style.display = 'none';

          // Optional: add shadow plane
          const shadow = document.createElement('a-plane');
          shadow.setAttribute('rotation', '-90 0 0');
          shadow.setAttribute('position', `${pos.x} ${pos.y + 0.01} ${pos.z}`);
          shadow.setAttribute('width', 1.8);
          shadow.setAttribute('height', 1.8);
          shadow.setAttribute('material', 'color: black; opacity: 0.2; transparent: true');
          scene.appendChild(shadow);
        });
      }
    });

    // Attach tap-place to scene
    document.querySelector('a-scene').setAttribute('tap-place', '');
  </script>
</body>
</html>
